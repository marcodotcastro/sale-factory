<div class="row">
  <div class="x_content">
    <div id="solicitacao-map"></div>
  </div>
</div>

<script>

    // This example requires the Visualization library. Include the libraries=visualization
    // parameter when you first load the API. For example:
    // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=visualization">

    var map, heatmap;

    function initMap() {
        map = new google.maps.Map(document.getElementById('solicitacao-map'), {
            zoom: 7,
            center: {lat: -16.6954997, lng: -49.4446992},
            mapTypeId: 'terrain'
        });

        heatmap = new google.maps.visualization.HeatmapLayer({
            data: getPoints(),
            map: map
        });
    }

    function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
    }

    function changeGradient() {
        var gradient = [
            'rgba(0, 255, 255, 0)',
            'rgba(0, 255, 255, 1)',
            'rgba(0, 191, 255, 1)',
            'rgba(0, 127, 255, 1)',
            'rgba(0, 63, 255, 1)',
            'rgba(0, 0, 255, 1)',
            'rgba(0, 0, 223, 1)',
            'rgba(0, 0, 191, 1)',
            'rgba(0, 0, 159, 1)',
            'rgba(0, 0, 127, 1)',
            'rgba(63, 0, 91, 1)',
            'rgba(127, 0, 63, 1)',
            'rgba(191, 0, 31, 1)',
            'rgba(255, 0, 0, 1)'
        ]
        heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
    }

    function changeRadius() {
        heatmap.set('radius', heatmap.get('radius') ? null : 200);
    }

    function changeOpacity() {
        heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
    }


    function getPoints() {
        var solicitacoes = [];

        <% @solicitacoes.each do |solicitacao| %>
        <% unless solicitacao.lojista.cidade.longitude.nil? and solicitacao.lojista.cidade.latitude.nil? %>
        console.log("<%= solicitacao.lojista.cidade.latitude  %>");
        console.log("<%= solicitacao.lojista.cidade.longitude  %>");

        console.log(new google.maps.LatLng(<%= solicitacao.lojista.cidade.latitude %>, <%= solicitacao.lojista.cidade.longitude %>))
        solicitacoes.push(new google.maps.LatLng(<%= solicitacao.lojista.cidade.latitude %>, <%= solicitacao.lojista.cidade.longitude %>));
        <% end %>
        <% end %>

        console.log(solicitacoes);

        return solicitacoes;
    }

</script>
